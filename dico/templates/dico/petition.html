<!DOCTYPE html>
<html lang="en">
{% load staticfiles %}
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>I Do Declare - Action</title>

    <!-- Bootstrap core CSS -->
    <link href="{% static "bootstrap/css/bootstrap.min.css" %}" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="{% static "dico/css/dicopage.css" %}" rel="stylesheet">
    <link href="{% static "dico/css/mapus.css" %}" rel="stylesheet">
    <link href="{% static "dico/css/petition.css" %}" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

	<!-- Styles for this web page -->
	<style>
		body {
		  padding-top: 55px;
		  padding-bottom: 55px;
		}
		section>section {
			padding-top: 10px;
			display: none;	/* Initially, hide them all. */
		}
		#id_petitionNav>li>a {
			padding-left: 10px;
			padding-right: 10px;
		}
		.well {
			margin-top: 10px;
			padding: 0px;
		}
		#id_voteSection>div>div>label {
			width: 110px;
		}
		#id_voteSection>div>div {
			display: block;
			margin: 0 auto;
			width: 328px;
		}
		#yourVoteButton {
			left: 108px;
		}
		#id_nextlink {
			margin-top:10px;
			width:100%;
			text-align:center;
		}
		#id_nextlink:hover {
			text-decoration: none;
			cursor: pointer;
		}
		.panelNav {
			display: none;
		}
	</style>
	<style>
		footer {
			visibility: hidden;
		}
		h3 {
			width: 100%;
			text-align: center;
		}
		.fb-login-button {
			width: 100%;
			text-align: center;
			display: block;
		}
		.centered-p {
			width: 100%;
			text-align: center;
		}
	</style>
  </head>
  
	<body>
		<div id='container' class="container-fluid">
			<nav class="navbar navbar-default navbar-fixed-top dico-navbar" role="navigation">
				<div class="container-fluid">
					<div class="pull-left">
						<div id="id_backButton" class="navbar-link dico-navbar-link" onClick="go_back()">
							<span class="glyphicon glyphicon-chevron-left"></span>{{ backName }}
						</div>
					</div>
					{% if user.is_authenticated %}
					<div class="pull-right">
						<div id="id_editButton" class="navbar-link dico-navbar-link" onClick="edit_action()"}>
							Edit
						</div>
					</div>
					{% endif %}
					<div class="dico-navbar-commands">
						<div class="dico-title dico-fill"><span class="dico-inner-fill">An Action for Congress</span></div>
					</div>
				</div>
			</nav>
		<nav class="navbar navbar-default navbar-fixed-bottom dico-navbar" role="navigation">
			{% if user.id == petition.constituent.user.id or user.is_superuser %}
			<div id="id_voteNav" class="container-fluid panelNav" section="id_voteSection">
				<!-- Brand and toggle get grouped for better mobile display -->
				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="pull-right">
					<div id="id_deleteActionButton" class="dico-navbar-link text-danger"}>
						Delete Action
					</div>
				</div>
			</div>
			{% endif %}
			{% if user.is_authenticated %}
			<div id="id_debateNav" class="container-fluid panelNav" section="id_debateSection">
				<!-- Brand and toggle get grouped for better mobile display -->
				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="pull-left">
					<div class="navbar-link dico-navbar-link" onClick="add_supporting_argument()"}>
						Add Supporting Argument
					</div>
				</div>
				<div class="pull-right">
					<div class="navbar-link dico-navbar-link" onClick="add_opposing_argument()"}>
						Add Opposing Argument
					</div>
				</div>
			</div>
			<div id="id_notesNav" class="container-fluid panelNav" section="id_notesSection">
				<!-- Brand and toggle get grouped for better mobile display -->
				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="pull-left">
					<div class="navbar-link dico-navbar-link" onClick="add_issue()"}>
						Add Issue
					</div>
				</div>
				<div class="pull-right">
					<div class="navbar-link dico-navbar-link" onClick="add_note()"}>
						Add Note
					</div>
				</div>
			</div>
			<div id="id_storyNav" class="container-fluid panelNav" section="id_storySection">
				<!-- Brand and toggle get grouped for better mobile display -->
				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="pull-left">
					<div class="navbar-link dico-navbar-link" onClick="add_story()"}>
						Share Your Story
					</div>
				</div>
			</div>
			{% endif %}
			
			<div class="container-fluid">
						<!-- Brand and toggle get grouped for better mobile display -->
						<!-- Collect the nav links, forms, and other content for toggling -->
				<ul id="id_petitionNav" class="nav nav-tabs pull-left" role="navigation" aria-label="actionButtons">
					<li section="id_voteSection"><a id="id_voteButton" href="#">Vote</a></li>
					<li section="id_notesSection"><a id="id_notesButton" href="#">Notes</a></li>
					<li section="id_debateSection"><a id="id_debateButton" href="#">Debate</a></li>
					<li section="id_statsSection"><a id="id_mapsButton" href="#">Stats</a></li>
					<li section="id_storySection"><a id="id_storyButton" href="#">Stories</a></li>
				</ul>
			</div>
		</nav>

		<div class="row">
	    	<div id="myAlert" class="col-xs-12"></div>
		</div>
		<div class="row">
			<div class="col-xs-12">
				<p><strong>{{petition.description}}</strong></p>
			</div>
		</div>
		
		<div class="row">
				<hr class="simple-separator" />
		</div>

		<section id="id_petitionSections">
			<section id="id_notesSection" class="row">
				<div class="col-xs-12">
					<div class="row">
						<div class="col-xs-12">
							<style>
								.table-condensed-xs>tbody>tr>td,
								.table-condensed-xs>thead>tr>th {
									padding-left: 5px;
									padding-right: 5px;
								}
								.table-condensed-xs>tbody>tr>td>span:hover {
									text-decoration: none;
								}
							</style>
							<table class="table-condensed-xs">
								<thead>
									<tr>
										<th class"editTool" style="width:1px"></th>
										<th style:"width:100%">Issues</th>
									</tr>
								</thead>
								<tbody id='id_petition_issues'></tbody>
							</table>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-12">
							<table class="table table-condensed table-striped">
								<thead>
									<tr>
										<th class"editTool" style="width:1px"></th>
										<th style:"width:100%">Notes</th>
									</tr>
								</thead>
								<tbody id='id_petition_notes'></tbody>
							</table>
						</div>
					</div>
					
				</div>
			</section>
			<section id="id_voteSection" class="row">
			{% if user.is_authenticated %}
				<div class="col-xs-12">
					<div class="btn-group" data-toggle="buttons">
						<label id="opposeButton" class="btn btn-default" 
								checkedclass="btn-danger" voteButtonLeft="0">
						  <input type="radio" name="voteOptions" id="opposeRadio" value=0 />
						  <span class="glyphicon glyphicon-thumbs-down"></span>&nbsp;Oppose
						</label>			
						<label id="noOpinionButton" class="btn btn-default" 
								checkedclass="btn-warning"  voteButtonLeft="108">
						  <input type="radio" name="voteOptions" id="noOpinionRadio" value=-1 />No Opinion
						</label>
						<label id="supportButton" class="btn btn-default" 
								checkedclass="btn-success" voteButtonLeft="216">
						  <input type="radio" name="voteOptions" id="supportRadio" value=1 />
						  <span class="glyphicon glyphicon-thumbs-up"></span>&nbsp;Support
						</label>
					</div>
				</div>
				<div class="col-xs-12">
					<div class="well">
						<label id="yourVoteButton" class="btn btn-default btn-warning">
						    Your Vote
						</label>
					</div>
				</div>
				<div class="col-xs-12">
					<div>
						<div id="id_nextlink" class="text-muted" onclick="go_to_next_petition()"> 
							{% if nextPetition %}
							Next Action
							<span class="glyphicon glyphicon-chevron-right"></span>
							{% else %}
								{% if showDoneVoting %}
								Done Voting
								<span class="glyphicon glyphicon-chevron-right"></span>
								{% endif %}
							{% endif %}
						</div>
					</div>
				</div>
			{% else %}
				<footer>
					<h3>Log in to Vote!</h3>
					<div class="social-login">
						<fb:login-button class="fb-login-button" data-max-rows="1" data-size="large" 
							data-show-faces="false" data-auto-logout-link="false" 
							scope="public_profile,email" onlogin="checkFacebookLogin();">
						</fb:login-button>
						<p class="centered-p">Or</p>
					</div>
					<p class="centered-p">
						<a id="id_loginLink">Log in with your Email address</a>
					</p>
					<p class="centered-p">
						Don't have an account? <a id="id_signupLink">Sign Up Now</a> 
					</p>
				</footer>
			{% endif %}
			</section>
			<section id="id_debateSection" class="row">
				<div class="col-xs-12 col-md-6">
					<table class="table table-striped table-condensed argument-container">
						<thead>
							<th style:"width:1px"></th>
							<th>Supporting Arguments
							</th>
							<th>Your Rating 
								<button class="btn btn-link btn-xs" onClick="doc_ratings()"}>
									<span class="glyphicon glyphicon-question-sign"></span>
								</button>
							</th>
						</thead>
						<tbody id='id_supporting_arguments'>
						</tbody>
					</table>
				</div>
				<div class="col-xs-12 col-md-6">
					<table class="table table-striped table-condensed argument-container">
						<thead>
							<th style:"width:1px"></th>
							<th>Opposing Arguments
							</th>
							<th>Your Rating 
								<button class="btn btn-link btn-xs" onClick="doc_ratings()"}>
									<span class="glyphicon glyphicon-question-sign"></span>
								</button>
							</th>
						</thead>
						<tbody id='id_opposing_arguments'>
						</tbody>
					</table>
				</div>
			</section>
			<section id="id_statsSection">
				<div class="row">
					<div class="col-xs-12">
						<div id="id_total_votes" class="bottom-padding">
							<span class='text-muted'>
								<span class="dico-span-link">
									<span class='glyphicon glyphicon-thumbs-up'></span>
									<span id="id_support_span"></span><br>
									<span class='glyphicon glyphicon-thumbs-down'></span>
									<span id="id_oppose_span"></span>
								</span>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-xs-6">
						<div class="radio">
							<label>
							  <input type="radio" name="mapVoteOptions" id="id_supportRadio" value=1 checked /> in Support
							</label>
						</div>
						<div class="radio">
							<label class="radio">
							  <input type="radio" name="mapVoteOptions" id="id_opposeRadio" value=0 /> in Opposition
							</label>
						</div>
					</div>
					<div class="col-xs-6">
						<div class="radio">
							<label>
							  <input type="radio" name="mapScopeOptions" id="byDistrictRadio" value=districtScope checked /> by District
							</label>
						</div>
						<div class="radio">
							<label>
							  <input type="radio" name="mapScopeOptions" id="byStateRadio" value=stateScope /> by State
							</label>			
						</div>
					</div>
				</div>
				<div class="row">
					<div id="mapFrame" class="col-xs-12"> </div>
					<div class="col-xs-12">
						<label id="district_label" for="district_span" class="control-label">District: </label> 
						<span id="district_span"></span><br>
						<label for="id_constituent_table" id="my_label" class="control-label">By the numbers</label>
						<table id='id_constituent_table' class="table table-striped table-condensed">
							<thead>
								<th id="id_constituent_area_label">District
								</th>
								<th>Supporting
								</th>
								<th>Opposing
								</th>
							</thead>
							<tbody id='id_constituent_table_body'>
							</tbody>
						</table>
					</div>
				</div>
			</section>
			<section id="id_storySection">
				Loading stories...
			</section>
		</section>
	</div> <!-- container -->

<!-- Modal HTML -->
	<div id="id_deleteDialog" class="modal fade">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-body">
					<button id="id_confirmDeleteButton" type="button" data-dismiss="modal" class="btn btn-danger btn-block">Delete Argument</button>
					<button type="button" class="btn btn-default btn-block" data-dismiss="modal">Cancel</button>
				</div>
			</div>
		</div>
	</div>
	
	<div id="id_deleteNoteDialog" class="modal fade">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-body">
					<button id="id_confirmDeleteNoteButton" type="button" data-dismiss="modal" class="btn btn-danger btn-block">Delete Note</button>
					<button type="button" class="btn btn-default btn-block" data-dismiss="modal">Cancel</button>
				</div>
			</div>
		</div>
	</div>
	
	<div id="id_deleteStoryDialog" class="modal fade">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-body">
					<button id="id_confirmDeleteStoryButton" type="button" data-dismiss="modal" class="btn btn-danger btn-block">Delete Story</button>
					<button type="button" class="btn btn-default btn-block" data-dismiss="modal">Cancel</button>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Modal HTML -->
	<div id="id_deleteActionDialog" class="modal fade">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-body">
					<button id="id_confirmDeleteActionButton" type="button" data-dismiss="modal" class="btn btn-danger btn-block">Delete Action</button>
					<button type="button" class="btn btn-default btn-block" data-dismiss="modal">Cancel</button>
				</div>
			</div>
		</div>
	</div>
</body>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="{% static "jquery/js/jquery.min.js" %}"></script>
<script src="{% static "jqueryui/js/jquery-ui.min.js" %}"></script>
<script src="{% static "jqueryui/js/jquery.ui.touch-punch.min.js" %}"></script>
<script src="{% static "jquerycookie/jquery.cookie.js" %}"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="{% static "bootstrap/js/bootstrap.min.js" %}"></script>
<script src="{% static "d3/d3.v3.min.js" %}"></script>
<script src="{% static "d3/queue.v1.min.js" %}"></script>
<script src="{% static "d3/topojson.v1.min.js" %}"></script>
<script src="{% static "jquery/js/spin.min.js" %}"></script>
<script src="{% static "dico/js/mapus.js" %}"></script>

<!-- Scripts for this web page -->
<script type="text/JavaScript">

	var deferredObject;

	function htmlEncode(input){
		return $('<div>').text(input).html();
	}
	
	// Display all of the interests in the system.
	var storedcsrftoken = "{{ csrf_token }}";
	var elementToDelete = null;
	
	var petitionVotesShown = false;	// Covers totals and current user's vote.
	var labelShown = false;
	var mapsShown = false;
	var debateShown = false;
	var storiesShown = false;
	var choicesInitialized = false;
	var mapRadiosInitialized = false;
	var inEditMode = false;			// True if currently editing.
	
	$(document).ready (function(e) {
		<!-- Block of code for an alert area at the top of the window -->
		$(".close").click(function(){
			$(this).parent().alert();
		});
		
		bootstrap_alert = function() {}
		bootstrap_alert.show = function(parentDiv, message, alertClass) {
			parentDiv.html('<div class="alert ' + alertClass + ' alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><span>'+message+'</span></div>')
		}
		bootstrap_alert.warning = function(message) {
			bootstrap_alert.show($('#myAlert'), message, "alert-danger");
		}
		closealert = function() { 
			$('.alert').parent().html('');
		}
		
		$("#id_confirmDeleteButton").click(function() {
			remove_argument(elementToDelete, $("#id_deleteDialog").attr("argumentId"));
		});

		$("#id_confirmDeleteNoteButton").click(function() {
			remove_note(elementToDelete, $("#id_deleteNoteDialog").attr("noteId"));
		});

		$("#id_confirmDeleteStoryButton").click(function() {
			remove_story(elementToDelete, $("#id_deleteStoryDialog").attr("storyId"));
		});

		$("#id_confirmDeleteActionButton").click(function() {
			remove_petition();
		});
		
		$("#id_deleteActionButton").click(function() {
			$("#id_deleteActionDialog").modal('show');
		});		
		
		var oldButton=$("#noOpinionButton");
		$('#yourVoteButton').draggable( {
			containment: 'parent',
			start: function(event, ui )
				{ start_vote_drag() },
			drag: function( event, ui ) 
				{ check_vote_drag(event, ui) },
			stop: function( event, ui )
				{ stop_vote_drag() },
		}
		);
		
		function get_new_button(newLeft)
		{
			center = newLeft + ($('#yourVoteButton').width() / 2) + 
				parseInt($('#yourVoteButton').css("padding-left"));
			if (center < parseInt($('#noOpinionButton').attr('voteButtonLeft')))
				return $('#opposeButton');
			else if (center < parseInt($('#supportButton').attr('voteButtonLeft')))
				return $('#noOpinionButton');
			else
				return $('#supportButton');
		}
		
		function start_vote_drag()
		{
			oldButton = $('input[name="voteOptions"]:checked').parent();
		}
		
		function check_vote_drag(event, ui)
		{
			newButton = get_new_button(ui.position.left);
			if (oldButton.attr('checkedClass') != newButton.attr('checkedClass'))
			{
				$('#yourVoteButton').addClass(newButton.attr('checkedClass'));
				$('#yourVoteButton').removeClass(oldButton.attr('checkedClass'));
				oldButton = newButton;
			}
		}
		
		function stop_vote_drag()
		{
			if (oldButton.attr('checkedClass') != $('input[name="voteOptions"]:checked').parent().attr('checkedClass'))
			{
				oldButton.click();
			}
			else
			{
				align_button(oldButton, $("#yourVoteButton"));
			}
		}
		
		var a = $("#id_petitionNav");
		var kids = a.children();
		
		kids.click(function() {
			$(this).siblings().removeClass("active");
			$(this).addClass("active");
			$("section>section").css("display", "none");
			$("#"+$(this).attr("section")).css("display", "block");
			{% if user.is_authenticated %}
				setup_edit();
			{% endif %}
		});
		
		function setup_map_radios()
		{
			if (!mapRadiosInitialized) {
				$("#id_supportRadio").change( function() {
					change_vote($(this).val(), getscope());
				});
				$("#id_opposeRadio").change( function() {
					change_vote($(this).val(), getscope());
				});
				$("#byDistrictRadio").change( function() {
					show_vote_map(districtScope);
				});
				$("#byStateRadio").change( function() { 
					show_vote_map(stateScope);
				});
				mapRadiosInitialized = true;
			}
		}
		
		$("#id_mapsButton").click(
			function() {
				if (!petitionVotesShown) {
					// Show the votes for the current petition.
					show_petition_votes(true);
					petitionVotesShown = true;
				}
				if (!mapsShown) {
					initmapheight("#mapFrame");
					init_map_width();
					show_petition_maps();
					mapsShown = true;
				}
				setup_map_radios();
			});
			
		
		$("#id_voteButton").click( function() {
			if (!petitionVotesShown) {
				// Show the votes for the current petition.
				show_petition_votes(true);
				petitionVotesShown = true;
			}
		});
		
		$("#id_debateButton").click( function() {
			if (!debateShown) {
				// Display the arguments of the current petition.
				show_petition_arguments();
				debateShown = true;
			}
		});
		
		$("#id_notesButton").click( function() {
			if (!labelShown) {
				// Display the issues associated with the current petition.
				show_petition_issues();
				show_petition_notes();
				labelShown = true;
			}
		});
		
		$("#id_storyButton").click( function() {
			if (!storiesShown) {
				show_petition_stories();
				storiesShown = true;
			}
		});
		
		inEditMode = {{inEditMode}};
		$("{{initialButton}}").click();
		
	});
	
	function setup_edit() {
		{% if user.is_authenticated %}
			// Return the display for editingnav's associated with the specified item.
			function editNavDisplay(id) {
				if (inEditMode) 
					return $(id).css("display"); 
				else 
					return "none";
			}
		
			// Set up the text of the Edit button ("", Edit or Done),
			$("#id_editButton").text(function() {
			if ($("#id_voteSection").css("display") != "none" ||
				$("#id_statsSection").css("display") != "none")
				return "";
			else if (inEditMode)
				return "Done";
			else
				return "Edit";
			});
			
			// Set up the visibility of all of the panel navs
			$(".panelNav").css("display", 
							   function() { 
									return editNavDisplay("#" + $(this).attr("section")); 
							   });
			
			if (inEditMode)				   
				$(".editTool").css("display", "table-cell");
			else
				$(".editTool").css("display", "none");
				
			// Set up the pointers over the issue links.
			if (inEditMode)
				$(".table-condensed-xs>tbody>tr>td>span").css("cursor", '');
			else
				$(".table-condensed-xs>tbody>tr>td>span").css("cursor", "pointer");
				
		{% endif %}
		$("body").css("padding-bottom", $(".navbar-fixed-bottom").height());
	}
	
	function go_to_next_petition() {
		{% if nextPetition %}
			var backURL = encodeURIComponent("{{backURL}}");
			var backName = encodeURIComponent("{{backName}}");
			window.location.href = "/dico/{{nextPetition.id}}/petition/?vote;showNext;backURL="+backURL+";backName="+backName;
		{% else %}
			window.location.href = "{{backURL}}"
		{% endif %}
	}

	function show_petition_issues() {
	  $.post("{% url 'getPetitionIssues' %}", { csrfmiddlewaretoken: storedcsrftoken, "petition" : "{{petition.id}}" }, function(json){
		if (json['success']) {
			issues = json['issues'];
		
			$("#id_petition_issues").empty();
			
			rows = d3.select("#id_petition_issues").selectAll("tr")
					.data(issues)
					.enter()
					.append("tr");
			
			<!-- Add a button to delete the issue from the action -->
			rows.append("td")
				.append("button")
				.classed("btn btn-link btn-xs editTool", true)
				.style("display", "inline-block")
				.filter(function(d) { return d['isEditable'] && issues.length > 1 })
				.append("span")
				.classed("glyphicon glyphicon-remove editTool", true)
				.attr("issueID", function(d) { return d['id']})
				.on('click', function() {
					if (inEditMode)
					{
						closealert();
						remove_issue($(this).parent(), $(this).attr("issueID"));
					}
				});

			rows.append("td")
				.append("span")
				.classed("small text-muted", true)
				.text(function(d) { return htmlEncode(d['name']); })
				.attr("issue", function(d) { return d['id']; })
				.on('click', function() {
					if (!inEditMode)
					{
						window.location.href = "{% url 'issue' %}?issue=" + $(this).attr('issue');
					}
				});
				
			setup_edit();
				
		}
		else
			bootstrap_alert.warning(json['error']);
	  });
	}
	
	function add_issue() {
		var backURL = encodeURIComponent("{{backURL}}");
		var backName = encodeURIComponent("{{backName}}");
		window.location.href = "/dico/{{petition.id}}/addpetitionissue/?backURL="+backURL+";backName="+backName;
	}
	
	function remove_issue(li, issue_id) {
	  $.post("{% url 'deletePetitionIssue' %}", { csrfmiddlewaretoken: storedcsrftoken, "petition_id" : "{{petition.id}}", "issue_id" : issue_id }, function(json){
		if (json['success']) {
			$(li).remove();
		}
		else
			bootstrap_alert.warning(json['error']);
		});
	}
	
	function show_petition_notes() {
		$("#id_petition_notes").empty();
	
	  $.post("{% url 'getPetitionNotes' %}", { csrfmiddlewaretoken: storedcsrftoken, "id" : "{{petition.id}}" }, function(json){
		if (json['success']) {
			notes = json['notes'];
			
			if (notes.length == 0)
			{
				var rows = d3.select("#id_petition_notes")
				  .append("tr");
				rows.append("td");
				rows.append("td")
					.text("No notes related to this action.");
			}
			else
			{
				var rows = d3.select("#id_petition_notes").selectAll("tr")
					.data(notes)
					.enter()
					.append("tr");

				// Add buttons to each media item that is editable.	   
				rows.append("td")
					.append("button")
					.classed("btn btn-link btn-xs editTool", true)
					.attr("noteId", function(d) { return d['id']; })
					.style("display", "inline-block")
					.filter(function(d) { return d['isEditable']; })
					.on("click", function() {
						if (inEditMode)
						{
							closealert();
							$("#id_deleteNoteDialog").attr("noteId", $(this).attr("noteId"));
							elementToDelete = $(this).parent().parent();
							$("#id_deleteNoteDialog").modal('show');
						}
					})
					.append("span")
					.classed("glyphicon glyphicon-remove editTool", true);
					
				divs = rows.append("td")
					.append("div")
					.classed("media", "true");
			
				mediaBodies = divs.append("div")
								  .classed("media-body", true);
							  
				mediaBodies.append("small")
						   .classed("text-muted media-heading", true)
						   .text(function(d) { return d['heading'] + ": "; });
					   
				paragraphs = mediaBodies.append("span")
						   .text(function(d) { return d['description']; })
						   .filter(function(d) { return d['link'].length > 0; } );
				
				paragraphs.append("span")
						   .text("  ");
				paragraphs.append("a")
						   .attr("href", function(d) { return d['link']; })
						   .attr("target", "_blank")
						   .append("span")
						   .classed("glyphicon glyphicon-new-window", true);
						   
				setup_edit();
			}
		}
		else
			bootstrap_alert.warning(json['error']);
	  })
	  .fail(function(jqXHR, textStatus, errorThrown)
		{
			bootstrap_alert.warning(jqXHR.status + "; " + jqXHR.statusText);
			console.log( "error: " + textStatus + "; " + errorThrown + ";");
			console.log( jqXHR.status + "; " + jqXHR.statusText);
		});
	}
	
	function add_note() {
		var backURL = encodeURIComponent("{{backURL}}");
		var backName = encodeURIComponent("{{backName}}");
		window.location.href = "{% url 'addNote' %}?petition={{petition.id}};backURL="+backURL+";backName="+backName;
	}
	
	function remove_note(li, note_id) {
	  $.post("{% url 'deleteNote' %}", { csrfmiddlewaretoken: storedcsrftoken, "id" : note_id }, function(json){
		if (json['success']) {
			$(li).remove();
		}
		else
			bootstrap_alert.warning(json['error']);
		});
	}
	
	function add_story() {
		var backURL = encodeURIComponent("{{backURL}}");
		var backName = encodeURIComponent("{{backName}}");
		window.location.href = "{% url 'addStory' %}?petition={{petition.id}};backURL="+backURL+";backName="+backName;
	}
	
	function show_petition_arguments() {
	  $.post("{% url 'getPetitionArguments' %}", { csrfmiddlewaretoken: storedcsrftoken, "petition" : "{{petition.id}}" }, function(json){
		if (json['success']) {
			supportingArguments = json['supportingArguments'];
			opposingArguments = json['opposingArguments'];
		
			$("#id_supporting_arguments").empty();
			if (supportingArguments.length == 0) {
				append_zero_arguments($("#id_supporting_arguments"));
			} else {
				for (i = 0; i < supportingArguments.length; ++i) {
					append_argument(supportingArguments[i], "#id_supporting_arguments");
				}
			}
			$("#id_opposing_arguments").empty();
			if (opposingArguments.length == 0) {
				append_zero_arguments($("#id_opposing_arguments"));
			} else {
				for (i = 0; i < opposingArguments.length; ++i) {
					append_argument(opposingArguments[i], "#id_opposing_arguments");
				}
			}
			setup_edit();
		}
		else
			bootstrap_alert.warning(json['error']);
	  })
	  .fail(function(jqXHR, textStatus, errorThrown)
		{
			bootstrap_alert.warning(jqXHR.status + "; " + jqXHR.statusText);
			console.log( "error: " + textStatus + "; " + errorThrown + ";");
			console.log( jqXHR.status + "; " + jqXHR.statusText);
		});
	}
	
	function append_zero_arguments(containerObj) {
		li = document.createElement("tr");
		containerObj.append(li);
		textdiv = document.createElement("td");
		$(li).append(textdiv);
		$(textdiv).html("None");
		$(li).append(document.createElement("td"));
		$(li).append(document.createElement("td"));
	}
	
	ratingData = [ {'text' : 'Central', 'value' : 5},
				   {'text' : 'Peripheral', 'value' : 4},
				   {'text' : 'Irrelevent', 'value' : 3},
				   {'text' : 'Opinion', 'value' : 2},
				   {'text' : 'Misleading', 'value' : 1},
				   {'text' : 'False', 'value' : 0},
				  ];
				  
	function append_argument(arg, containerObj) {
		li = d3.select(containerObj).append("tr");
		newButton = li.append("td")
		  .append("button")
		  .classed("btn btn-link btn-xs editTool", true)
		  .attr("argumentId", arg['id'])
		  .on('click', function() {
								if (inEditMode)
									{
										closealert();
										$("#id_deleteDialog").attr("argumentId", $(this).attr("argumentId"));
										elementToDelete = $(this).parent().parent();
										$("#id_deleteDialog").modal('show');
									}
								});
		if (arg['isEditable']) {
			newButton.append("span")
					 .classed("glyphicon glyphicon-remove editTool", true);
		}

		newParagraph = li.append("td")
						 .text(htmlEncode(arg['description']));
		
		ratingGroupDiv = li.append("td").append("div")
								   .classed("btn-group", true);
		set_rating_button(ratingGroupDiv, arg['rating_vote'], arg['id']);
	}
	
	function set_rating_button(ratingGroupDiv, ratingVote, argumentID) {
		ratingGroupDiv.html('');
		if (ratingVote === null || ratingVote == -1)
			ratingText = 'Rate Now';
		else
			ratingText = ratingData[ratingData.length - 1 - ratingVote].text;
			
		ratingGroupDiv.append("button")
					 .classed("btn btn-xs btn-link block-display dropdown-toggle", true)
					 .attr("data-toggle", "dropdown")
					 .html(ratingText + ' ')
					 .append("span")
					 .classed("caret", true);
		ratingMenu = ratingGroupDiv.append("ul")
								   .classed("dropdown-menu", true)
					 			   .attr("role", "menu");
		
		ratingItemButtons = ratingMenu.selectAll("li")
				  .data(ratingData)
				  .enter()
				  .append("li")
				  .append("button")
				  .classed("btn btn-xs btn-link", true)
				  .attr("argumentId", argumentID)
				  .attr("value", function(d) { return d.value; })
				  .on ('click', function() { 
								 theDiv = $(this).parents(".btn-group")[0];
								 rate_argument(d3.select(theDiv), $(this).attr("argumentId"), $(this).val());
								 });
		ratingItemButtons
				  .append("span")
				  .classed("btn btn-xs btn-link glyphicon glyphicon-ok", true)
				  .classed("invisible", function(d) { return ratingVote != d.value });
				  
		ratingItemButtons
				  .text(function(d) { return d.text });

		if (ratingVote !== null) {
			ratingItem = document.createElement("li");
			ratingMenu.append("li")
					  .classed("divider", true);
			ratingMenu.append("li")
					  .append("button")
					  .classed("btn btn-xs btn-link", true)
					  .attr("argumentId", argumentID)
					  .text("Remove this rating")
					  .attr("value", -1)
					  .on ('click', function() { 
								 theDiv = $(this).parents(".btn-group")[0];
								 rate_argument(d3.select(theDiv), $(this).attr("argumentId"), $(this).val());
								 });
		}
	}
	
	function remove_argument(li, argument_id) {
	  $.post("{% url 'deleteArgument' %}", { csrfmiddlewaretoken: storedcsrftoken, "argument" : argument_id }, function(json){
		if (json['success']) {
			$(li).remove();
			if ($($("#id_supporting_arguments").children()[0]).children().length == 0)
				append_zero_arguments($("#id_supporting_arguments"));

			if ($($("#id_opposing_arguments").children()[0]).children().length == 0)
				append_zero_arguments($("#id_opposing_arguments"));

		}
		else
			bootstrap_alert.warning(json['error']);
		})
		.fail(function(jqXHR, textStatus, errorThrown)
		{
			bootstrap_alert.warning(jqXHR.status + "; " + jqXHR.statusText);
			console.log( "error: " + textStatus + "; " + errorThrown + ";");
			console.log( jqXHR.status + "; " + jqXHR.statusText);
		});
	}
	
	function add_supporting_argument() {
		var backURL = encodeURIComponent("{{backURL}}");
		var backName = encodeURIComponent("{{backName}}");
		window.location = "{% url 'addSupportingArgument' %}/?petition={{petition.id}};backURL="+backURL+";backName="+backName;
	}
	
	function add_opposing_argument() {
		var backURL = encodeURIComponent("{{backURL}}");
		var backName = encodeURIComponent("{{backName}}");
		window.location = "{% url 'addOpposingArgument' %}/?petition={{petition.id}};backURL="+backURL+";backName="+backName;
	}
	
	function doc_ratings() {
		var backURL = encodeURIComponent("{{backURL}}");
		var backName = encodeURIComponent("{{backName}}");
		window.location = "{% url 'docRatings' %}?petition={{petition.id}};backURL="+backURL+";backName="+backName;
	}
	
	function go_back() {
		window.location.href = "{{ backURL }}";
	}
	
	function edit_action() {
		inEditMode = !inEditMode;
		setup_edit();
	}
	
	function cast_vote(vote) {
		deferredObject = $.post("{% url 'newPetitionVote' %}", { csrfmiddlewaretoken: storedcsrftoken, 
													  "petition" : "{{petition.id}}",
													  "vote" : vote} 
			)
			.done(function(json, textStatus, jqXHR)
			{
				if (json['success']) {
					show_petition_votes(false);
				}
				else {
					bootstrap_alert.warning(json['error']);
				}
			})
			.fail(function(jqXHR, textStatus, errorThrown)
			{
				bootstrap_alert.warning(jqXHR.status + "; " + jqXHR.statusText);
				console.log( "error: " + textStatus + "; " + errorThrown + ";");
				console.log( jqXHR.status + "; " + jqXHR.statusText);
			});
	}
	
	function cast_support_vote(e, inputObj) {
		cast_vote(inputObj.value);
		e.stopPropagation();
	}
	
	function cast_oppose_vote(e, inputObj) {
		cast_vote(inputObj.value);
		e.stopPropagation();
	}
	
	function vote_no_opinion() {
		deferredObject = $.post("{% url 'deletePetitionVote' %}", { csrfmiddlewaretoken: storedcsrftoken, 
													  "petition" : "{{petition.id}}"} 
			)
			.done(function(json, textStatus, jqXHR)
			{
				if (json['success']) {
					show_petition_votes(false);
				}
				else {
					bootstrap_alert.warning(json['error']);
				}
			})
			.fail(function(jqXHR, textStatus, errorThrown)
			{
				bootstrap_alert.warning(jqXHR.status + "; " + jqXHR.statusText);
				console.log( "error: " + textStatus + "; " + errorThrown + ";");
				console.log( jqXHR.status + "; " + jqXHR.statusText);
			});
	}
	
	function align_button(source, target)
	{
		target.stop();
		marginDiff = parseInt(source.attr('voteButtonLeft')) - parseInt(target.css("left"));
		if (marginDiff < 0)
			target.animate({left: "-="+(-marginDiff)+"px"}, 250);
		else
			target.animate({left: "+="+marginDiff+"px"}, 250);
	}
	
	function set_button_display() {
		testClass = $(this).attr('checkedclass');
		if ($(this).children("input").prop('checked')) {
			$(this).addClass(testClass);
			if (!$("#yourVoteButton").hasClass(testClass))
				$("#yourVoteButton").addClass(testClass);
			align_button($(this), $("#yourVoteButton"));
		}
		else {
			$("#yourVoteButton").removeClass(testClass);
			$(this).removeClass(testClass);
		}
		
	}
	
	function setup_petition_radios() {
		if (!choicesInitialized) {
			// After showing the petition votes, set the change methods of the radio buttons
			// for the current user's vote.
			$("#supportRadio").change(function() {
				cast_vote(1);
			});
		
			$("#opposeRadio").change(function() {
				cast_vote(0);
			});
		
			$("#noOpinionRadio").change(function() {
				vote_no_opinion();
			});
			choicesInitialized = true;
		}
	}
	
	function show_petition_votes(init_user_vote) {
		deferredObject = $.get("{% url 'getPetitionVoteTotals' %}", { csrfmiddlewaretoken: storedcsrftoken, 
													  "petition" : "{{petition.id}}"} 
			)
			.done(function(json, textStatus, jqXHR)
			{
				if (json['success']) {
					supportVotes = 0;
					opposeVotes = 0;
					for (i=0; i < json['votes'].length; ++i) {
						vc = json['votes'][i];
						if (vc.vote == 0)
							opposeVotes = vc.count;
						else if (vc.vote == 1)
							supportVotes = vc.count;
					}
					
					if ('userVote' in json && json['userVote'] == 1) {
						if (supportVotes == 1)
							supportString = "You support this";
						else if (supportVotes == 2)
							supportString = "You and 1 other person support this";
						else
							supportString = "You and " + (supportVotes-1) + " other people support this";
					}
					else
					{
						if (supportVotes == 0)
							supportString = "No one supports this";
						else if (supportVotes == 1)
							supportString = "1 person supports this";
						else
							supportString = "" + supportVotes + " people support this";
					}
					if ('userVote' in json && json['userVote'] == 0) {
						if (opposeVotes == 1)
							opposeString = "You oppose this";
						else if (opposeVotes == 2)
							opposeString = "You and 1 other person oppose this";
						else
							opposeString = "You and " + (opposeVotes-1) + " other people oppose this";
					} else {
						if (opposeVotes == 0)
							opposeString = "No one opposes this";
						else if (opposeVotes == 1)
							opposeString = "1 person opposes this";
						else
							opposeString = "" + opposeVotes + " people oppose this";
					}
					
					$("#id_support_span").text(supportString);
					$("#id_oppose_span").text(opposeString);
					if ('userVote' in json) {
						if (init_user_vote) {
							if (json['userVote'] == 1) {
								$("#supportRadio").prop('checked', true);
								$("#supportButton").button('toggle');
							}
							else if (json['userVote'] == 0) {
								$('#opposeRadio').prop('checked', true);
								$("#opposeButton").button('toggle');
							}
						}
					}
					else
					{
						if (init_user_vote) {
							$('#noOpinionRadio').prop('checked', true);
							$('#noOpinionButton').button('toggle');
						}
					}
					
					$("input[name=voteOptions]").parent().each(set_button_display);
					mapsShown = false;
					
					// Now that the votes are set, handle change functions.
					setup_petition_radios();
				}
				else {
					bootstrap_alert.warning(json['error']);
				}
			})
			.fail(function(jqXHR, textStatus, errorThrown)
			{
				bootstrap_alert.warning(jqXHR.status + "; " + jqXHR.statusText);
				console.log( "error: " + textStatus + "; " + errorThrown + ";");
				console.log( jqXHR.status + "; " + jqXHR.statusText);
			});
	}
	
	function rate_argument(li, argument_id, rating) {
		var deferredObject;
		if (rating == -1)
			deferredObject = $.post("{% url 'unrateArgument' %}", { csrfmiddlewaretoken: storedcsrftoken, 
													  "argument" : argument_id});
		else
			deferredObject = $.post("{% url 'rateArgument' %}", { csrfmiddlewaretoken: storedcsrftoken, 
													  "argument" : argument_id,
													  "rating" : rating});

		deferredObject.done(function(json, textStatus, jqXHR)
			{
				if (json['success']) {
					set_rating_button(li, rating, argument_id);
				}
				else {
					bootstrap_alert.warning(json['error']);
				}
			})
			.fail(function(jqXHR, textStatus, errorThrown)
			{
				bootstrap_alert.warning(jqXHR.status + "; " + jqXHR.statusText);
				console.log( "error: " + textStatus + "; " + errorThrown + ";");
				console.log( jqXHR.status + "; " + jqXHR.statusText);
			});
	}
	
	// Ensure that the space for the map extends across the entire frame if possible.
	function init_map_width() {
		$("#mapFrame").width(window.innerWidth - 30);
	}
	
	function show_petition_maps() {
		initmap("#mapFrame", "{% static "dico/us.json" %}");
		show_vote_map(getscope());
	}

	function show_petition_stories() {
	  $.post("{% url 'getPetitionStories' %}", { csrfmiddlewaretoken: storedcsrftoken, "id" : "{{petition.id}}" }, function(json){
		if (json['success']) {
			stories = json['stories'];
			
			$("#id_storySection").empty();
			
			if (stories.length == 0)
			{
				d3.select("#id_storySection")
				  .append("div")
				  .classed("row", true)
				  .append("div")
				  .classed("col-xs-12", true)
				  .text("No stories related to this action.");
			}
			else
			{
				divs = d3.select("#id_storySection").selectAll("div")
					.data(stories)
					.enter()
					.append("div")
					.classed("row", true)
					.append("div")
					.classed("col-xs-12", true)
					.append("div")
					.classed("media", "true");
			
				divs.filter(function(story) { return story['link'].length > 0; } )
					.append("div")
					.classed("media-left", true)
					.append("a")
					.attr("href", function(story) { return story['link']; })
					.attr("target", "_blank")
					.append("img")
					.classed("media-object", true)
					.attr("src", function(story) { return story['link']; })
					.attr("height", 60)
					.attr("width", 60);
				
				mediaBodies = divs.append("div")
								  .classed("media-body", true);
							  
				mediaBodies.append("small")
						   .classed("text-muted media-heading", true)
						   .text(function(d) { return d['heading'] + ": "; });
					   
				paragraphs = mediaBodies.append("span")
						   .text(function(story) { return story['description']; })
						   .filter(function(story) { return story['link'].length > 0; } );
				
				paragraphs.append("span")
						   .text("  ");
				paragraphs.append("a")
						   .attr("href", function(d) { return d['link']; })
						   .attr("target", "_blank")
						   .append("span")
						   .classed("glyphicon glyphicon-new-window", true);
				
				// Add buttons to each media item that is editable.	   
				divs.filter(function(story) { return story['isEditable']; })
					.append("div")
					.classed("media-right", true)
					.append("button")
					.classed("btn btn-link btn-xs editTool", true)
					.attr("storyId", function(story) { return story['id']; })
					.on("click", function() {
						closealert();
						$("#id_deleteStoryDialog").attr("storyId", $(this).attr("storyId"));
						elementToDelete = $(this).parent().parent();
						$("#id_deleteStoryDialog").modal('show');
					})
					.style("display", "inline-block")
					.append("span")
					.classed("glyphicon glyphicon-remove editTool", true);
			}
			
			setup_edit();
		}
		else
			bootstrap_alert.warning(json['error']);
	  })
	  .fail(function(jqXHR, textStatus, errorThrown)
		{
			bootstrap_alert.warning(jqXHR.status + "; " + jqXHR.statusText);
			console.log( "error: " + textStatus + "; " + errorThrown + ";");
			console.log( jqXHR.status + "; " + jqXHR.statusText);
		});
	}
	
	function remove_story(li, story_id) {
	  $.post("{% url 'deleteStory' %}", { csrfmiddlewaretoken: storedcsrftoken, "story" : story_id }, function(json){
		if (json['success']) {
			$(li).remove();
		}
		else
			bootstrap_alert.warning(json['error']);
		})
		.fail(function(jqXHR, textStatus, errorThrown)
		{
			bootstrap_alert.warning(jqXHR.status + "; " + jqXHR.statusText);
			console.log( "error: " + textStatus + "; " + errorThrown + ";");
			console.log( jqXHR.status + "; " + jqXHR.statusText);
		});
	}
	
	function remove_petition() {
	  $.post("{% url 'deletePetition' %}", { csrfmiddlewaretoken: storedcsrftoken, "petition_id" : {{ petition.id }} }, function(json){
		if (json['success']) {
			window.location.href = "{{ backURL }}";
		}
		else
			bootstrap_alert.warning(json['error']);
		});
	}

	$(window).resize(function() {
		resize_vote_map();
	});
	
	function change_vote(newVote, newScope) {
	  $.getJSON("{% url 'getPetitionVotesByScope' %}", { petition: {{ petition.id }}, scope : newScope}, function(json){
		var s = "";
		if (json['error']) {
			s = json['error'];
			console.log(s);
			alert(s);
		} else {
			var vote;
			if (newVote == $("#id_supportRadio").val())
				vote = 'support_count';
			else
				vote = 'oppose_count';
			mapdatapoints("#mapFrame", 
						  "#id_constituent_area_label", 
						  newScope, 
						  json['votes'],
						  vote);
						  
			$("#id_constituent_table_body").empty();
	
			tr = d3.select("#id_constituent_table_body").selectAll("tr")
					.data(json['votes'])
					.enter()
					.append("tr");
	
			td = tr.selectAll("td")
					.data(function(d) { 
						if (newScope == districtScope)
							area =  d['state'] + "-" + d['district'];
						else
							area =  d['state'];
						return [area, d['support_count'], d['oppose_count']];
					})
					.enter()
					.append("td")
					.text(function(d) { return d; });
		}
	  });
	}

	function resize_vote_map() {
		$("#mapFrame").queue(function() {
			init_map_width();
			resize_map("#mapFrame");
			$("#mapFrame").dequeue();
		});			
	}
	
	function getscope() {
		if ($("#byDistrictRadio").prop("checked")) { 
			return districtScope;
		} else {
			return stateScope;
		}
		
	}
	
	function show_vote_map(newScope)
	{
		show_map("#mapFrame", $("#district_label"), $("#district_span"), 
				 "{% static "dico/us.json" %}",
				 "{% static "dico/us-congress-113.json" %}",
				 function() {
				 	change_vote($('input[name="mapVoteOptions"]:checked').val(), newScope); 
				 }, 
				 newScope);
	}
	
</script>

<!-- Scripts for this web page -->
<script type="text/JavaScript">	
	{% if user.is_authenticated %}
	{% else %}
		var isDocumentReady = false;
		var isFacebookLoginChecked = false;
	
		$(document).ready (function(e) {		
			isDocumentReady = true;
		
			if (document.domain == "127.0.0.1")	// Do not try for facebook if running in localHost.
			{
				isFacebookLoginChecked = true;
			}
			else
			{
				  (function(d, s, id) {
					var js, fjs = d.getElementsByTagName(s)[0];
					if (d.getElementById(id)) return;
					js = d.createElement(s); js.id = id;
					js.src = "//connect.facebook.net/en_US/sdk.js";
					fjs.parentNode.insertBefore(js, fjs);
				  }(document, 'script', 'facebook-jssdk'));
				window.fbAsyncInit = function() {
					FB.init({
						appId      : '{{facebookAppID}}',
						status     : true,
						cookie     : true,  // enable cookies to allow the server to access 
											// the session
						xfbml      : true,  // parse social plugins on this page
						version    : 'v2.3' // use version 2.3
					});

					FB.getLoginStatus(function(response) {
						isFacebookLoginChecked = true;
						statusChangeCallback(response);
					});
				};
			}
			showLoginOptions();

			var backURL = encodeURIComponent(window.location.href);
			$("#id_loginLink").attr("href", "{% url 'signin' %}?backURL="+backURL);
			$("#id_signupLink").attr("href", "{% url 'signup' %}?backURL="+backURL+";nextURL="+backURL);
		});
				
		// This is called with the results from from FB.getLoginStatus().
		function statusChangeCallback(response) {
			// The response object is returned with a status field that lets the
			// app know the current login status of the person.
			// Full docs on the response object can be found in the documentation
			// for FB.getLoginStatus().
			if (response.status === 'connected') {
			  // Logged into your app and Facebook.
			  // Hide the login button.
				testFBAPI(response);
			} else {
				showLoginOptions();
			}
		}

		  // Here we run a very simple test of the Graph API after login is
		  // successful.  See statusChangeCallback() for when this call is made.
		function testFBAPI(response) {
			$.post("{% url 'submitFacebookSignin' %}", { csrfmiddlewaretoken: '{{ csrf_token }}', 
														 "accessToken" : response.authResponse.accessToken },
			  function(json){
				if (json['success']) {
					$.cookie("authenticator", "Facebook", { path: "/"});
					if (json['setupRequired']) {
						var encodedRef = encodeURIComponent(window.location.href);
						nextURL = "{% url 'editInterests' %}?back="+encodedRef
						window.location.href = "{% url 'constituentSettings' %}?next="+nextURL+";accessToken="+json['accessToken'];
					}
					else
					{
						window.location.reload(true);
					}
				}
				else
				{
					bootstrap_alert.warning(json['error']);
					showLoginOptions();
				}
			});
		}

		function checkFacebookLogin() {
			FB.getLoginStatus(function(response) {
			  statusChangeCallback(response);
			});
		}
		
		function showLoginOptions()
		{
			if (isDocumentReady && isFacebookLoginChecked)
			{
				// Only show the footer once.
				if ($("footer").css("visibility") == "hidden")
				{
					$("footer").css("visibility", "visible");
				}
		
				if (document.domain !== "127.0.0.1")
					$(".social-login").css("display", "static");
				else
					$(".social-login").css("display", "none");
			}
		}
	{% endif %}
</script>

